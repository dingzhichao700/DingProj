var egret;
(function (egret) {
    var ElementNpc = (function (_super) {
        __extends(ElementNpc, _super);
        /**
         * 构造函数
         */
        function ElementNpc() {
            _super.call(this);
            //任务状态
            this._taskState = -1;
            //状态mc
            this._taskStateMc = null;
            //状态加载器
            this._loaderMap = null;
            this._loaderMap = new egret.HashMap();
            this.setTextFormat();
        }
        var __egretProto__ = ElementNpc.prototype;
        __egretProto__.setTextFormat = function () {
            this._namePad.setNameTextFormat();
        };
        Object.defineProperty(__egretProto__, "taskState", {
            get: function () {
                return this._taskState;
            },
            /**
             * 当前任务状态
             * @param value:int NpcTaskStateType
             *
             */
            set: function (value) {
                if (this._taskState == value)
                    return;
                this._taskState = value;
                this.clearState();
                //if(this._taskState == NpcTaskStateType.NONE){
                //	TimerManager.getInstance().addExecute(this.checkStateDestroy,DateUtil.VALUE_MINUTE_10,null,1);
                //}else{
                //	TimerManager.getInstance().removeExecute(this.checkStateDestroy);
                //	this.loadStateMc();
                //}
            },
            enumerable: true,
            configurable: true
        });
        //
        __egretProto__.update = function () {
            _super.prototype.update.call(this);
            //if(this.enabled){
            //	this.taskState = dataManager().taskData.getNpcTaskState(parseInt(this.id));
            //}else{
            //	this.taskState = NpcTaskStateType.NONE;
            //}
        };
        /**
         * 添加至场景时处理
         *
         */
        __egretProto__.addToScene = function () {
            _super.prototype.addToScene.call(this);
            this.update();
            var lo = (this._data.lo);
            if (lo) {
                if (lo.type == egret.NpcType.HOME || lo.type == egret.NpcType.SEARCH) {
                    this.play(0, egret.ActionType.PREPARE, egret.ActionMovieClipDirectionType.UP);
                }
            }
        };
        /**
         * 从场景移除时处理
         *
         */
        __egretProto__.removeFromScene = function () {
            _super.prototype.removeFromScene.call(this);
            this.taskState = egret.NpcTaskStateType.NONE;
        };
        //
        /**
         * 外部加载完成
         * @param loadDataItem
         *
         */
        //private firstLoadComplete(loadDataItem:LoadDataItem):void{
        //	this.loadStateMc();
        //}
        //
        /**
         * 内存中加载完成
         * @param loader
         *
         */
        //private loadStateComplete(loader:Loader,...args):void{
        //	//不能直接用_taskState，因加载过程中此值可能已改变
        //	this._loaderMap.put(args[0],loader);
        //	this.showStateMc();
        //}
        //
        /**
         * 加载状态资源
         *
         */
        __egretProto__.loadStateMc = function () {
            var states = [
                egret.NpcTaskStateType.UNRECEIVED,
                egret.NpcTaskStateType.UNFINISHED,
                egret.NpcTaskStateType.REWARD
            ];
            //var ids:Array<any> = [
            //	ResourceId.ID_RESOURCE_NPC_STATE_UNRECEIVED,
            //	ResourceId.ID_RESOURCE_NPC_STATE_UNFINISHED,
            //	ResourceId.ID_RESOURCE_NPC_STATE_REWARD
            //];
            //
            //var index:number = states.indexOf(this._taskState);
            //var id:string = ids[index];
            //
            //if(!id) return;
            //
            //if(this._loaderMap.get(this._taskState)){
            //	this.showStateMc();
            //}else{
            //	var loader:Loader = ResoureManager.getInstance().getResourceLoader(id);
            //	if(loader){
            //		//内存中加载
            //		ResoureManager.getInstance().loadBytes(loader.contentLoaderInfo.bytes,this.loadStateComplete,[this._taskState]);
            //	}else{
            //		//外部加载
            //		ResoureManager.getInstance().load([id],this.firstLoadComplete,null,null,true);
            //	}
            //}
        };
        //
        /**
         * 显示状态
         *
         */
        __egretProto__.showStateMc = function () {
            this.clearState();
            if (this._loaderMap.containsKey(this._taskState)) {
                this._taskStateMc = (this._loaderMap.get(this._taskState).content);
                this._namePad.show(this._taskStateMc, egret.NpcNameLayerType.STATE_LAYER);
            }
        };
        //
        /**
         * 清空状态
         *
         */
        __egretProto__.clearState = function () {
            //MovieClipUtil.playClip(this._taskStateMc,false);
            this._namePad.hide(this._taskStateMc);
            this._taskStateMc = null;
        };
        //
        /**
         * 检测销毁
         *
         */
        __egretProto__.checkStateDestroy = function () {
            var length = this._loaderMap.content.length;
            //for(var i:number = 0;i < length;i++){
            //	var loader:Loader = this._loaderMap.content[i];
            //	try{
            //		loader.close();
            //	}catch(e){
            //
            //	}
            //	loader.unload();
            //	loader.unloadAndStop();
            //}
            this._loaderMap.clear();
        };
        //
        /**
         * 获取部件影片地址
         * @param partType:String ActionPartType 动作影片类型
         * @return
         */
        __egretProto__.getPartUrl = function (partType) {
            return _super.prototype.getPartUrl.call(this, partType);
            //var path:string = PathData.PATH_MOVIES_NPC;
            //
            //var movie:string = this._sceneAvatarVo[partType];
            //
            //var url:string = this.dataManager().sceneElementData.getActionUrl(path,movie,this._avatar.actionType);
            //
            //return url;
        };
        return ElementNpc;
    })(egret.SceneElementDriver);
    egret.ElementNpc = ElementNpc;
    ElementNpc.prototype.__class__ = "egret.ElementNpc";
})(egret || (egret = {}));
//# sourceMappingURL=ElementNpc.js.map