var egret;
(function (egret) {
    var ActionMovieClipManager = (function () {
        /**
         * 构造函数
         */
        function ActionMovieClipManager() {
            //加载中的url
            this._loadUrlMap = null;
            //回调列表
            this._callBackMap = null;
            this._callBackTargetMap = null;
            this._loadUrlMap = new egret.HashMap();
            this._callBackMap = new egret.HashMap();
            this._callBackTargetMap = new egret.HashMap();
        }
        var __egretProto__ = ActionMovieClipManager.prototype;
        ActionMovieClipManager.getInstance = function () {
            return ActionMovieClipManager._instance || (ActionMovieClipManager._instance = new ActionMovieClipManager());
        };
        //
        /**
         * 加载动作影片数据
         * @param url:String 影片地址
         * @param callBack:Function = null 加载完成回调 function(){}
         *
         */
        __egretProto__.loadActionMovieClipVo = function (url, callBack, callBackTarget) {
            if (callBack === void 0) { callBack = null; }
            if (callBackTarget === void 0) { callBackTarget = null; }
            var array = this._callBackMap.get(url);
            if (!array) {
                array = new egret.HashMap();
                this._callBackMap.put(url, array);
            }
            if (!array.containsKey(callBackTarget.hashCode)) {
                this._callBackTargetMap.put(callBackTarget.hashCode, callBackTarget);
                array.put(callBackTarget.hashCode, callBack);
            }
            if (this._loadUrlMap.containsKey(url))
                return;
            if (egret.ActionMovieClipData.getInstance().getActionMovieClipVo(url))
                return;
            this._loadUrlMap.put(url, true);
            RES.getResByUrl(url, this.loadActionComplete, this);
        };
        //
        /**
         * 加载动作资源完成
         * @param loadDataItem
         *
         */
        __egretProto__.loadActionComplete = function (data, url) {
            if (data instanceof egret.SpriteSheet) {
                if (data) {
                    var jsonUrl = egret.ActionMovieClipData.getInstance().getJsonUrl(url);
                    var jsonData = egret.ActionMovieClipData.getInstance().getActionData(jsonUrl);
                    var vo = egret.ActionMovieClipUtil.getActionMovieClipVo(jsonData, data);
                    if (vo) {
                        egret.ActionMovieClipData.getInstance().setActionMoveClipVo(jsonUrl, vo);
                    }
                    else {
                        egret.LogManager.error(this, "无效的ActionMovieClipVo数据:" + vo);
                    }
                }
                else {
                    egret.LogManager.error(this, "加载到无效的动作数据:" + data);
                }
                var array = this._callBackMap.remove(jsonUrl);
                for (var i in array.content) {
                    var fun = array.get(i);
                    if (fun != null) {
                        var target = this._callBackTargetMap.get(i);
                        fun.apply(target, [jsonUrl]);
                    }
                }
            }
            else if (data instanceof Object) {
                egret.ActionMovieClipData.getInstance().setActionData(url, data);
                url = egret.ActionMovieClipData.getInstance().getSheetUrl(url);
                RES.getResByUrl(url, this.loadActionComplete, this, RES.ResourceItem.TYPE_SHEET);
            }
            else {
                egret.LogManager.error(this, "加载到无效的动作数据:" + data);
            }
        };
        ActionMovieClipManager._instance = null;
        return ActionMovieClipManager;
    })();
    egret.ActionMovieClipManager = ActionMovieClipManager;
    ActionMovieClipManager.prototype.__class__ = "egret.ActionMovieClipManager";
})(egret || (egret = {}));
//# sourceMappingURL=ActionMovieClipManager.js.map