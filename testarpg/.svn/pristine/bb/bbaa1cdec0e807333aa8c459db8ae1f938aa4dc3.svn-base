module egret{
    /**
     * 射手
     */
    export class PlayerBowman extends ElementPlayer{
        public constructor(){
            super();
        }
        //
        /**
         * 获取攻击范围，不同职业和怪物重写
         * @returns {number}
         */
        public getAttackRange():number{
            return 300;
        }
        //
        /**
         * 玩家攻击方法
         */
        public attack():void{
            if(this._isLocked) return;
            if(this.isSkillStatus) return;
            if(!this._attackTarget) return;
            if((<SceneDriverVo>this._attackTarget.vo).hp <= 0) return;

            this.stopMove();

            var direction:number = ActionMovieClipData.getInstance().calculateDirection(this.x,this.y,this._attackTarget.vo.x,this._attackTarget.vo.y);

            //召唤神兽
            if(!RoleManager.getInstance().hasAnimal && this.getSkillTime(SkillType.BOWMAN_CALL) > dataManager().fightData.getSkillIntervalTime(SkillType.BOWMAN_CALL)){
                this.setUseSkill(SkillType.BOWMAN_CALL);

                RoleManager.getInstance().addAnimal(this);
            }

            //攻击
            if(this._avatar.actionType != ActionType.ATTACK){
                this.play(0,ActionType.ATTACK,direction);
                this._avatar.setFrameHandler(this.playSkill,this);
            }
        }

        //
        /**
         * 释放技能
         */
        public playSkill():void {
            if (!this.scene) return;

            //职业及技能类型处理
            var playerVo:ScenePlayerVo = <ScenePlayerVo>this.data.vo;

            if(this._avatar.frameIndex == 2){
                var mageSkill:ElementMageNormalSkill = <ElementMageNormalSkill>SceneElementManager.getInstance().getElement(ElementMageNormalSkill);
                mageSkill.setMovieName(SceneElementData.getInstance().getSkillMovieName(playerVo.vocation,1));
                this.scene.addElement(mageSkill,SceneLayerType.BATTLE_EFFECT);
                mageSkill.attackTo(this.x,this.y - 50,this._attackTarget,0,-50,90,this.getAttackRange());

                this.damage(SkillType.BOWMAN_NORMAL);
            }else if(this._avatar.frameIndex == this._avatar.frameIndexMax){
                this.chaseArmies(this.armies);
                //this.checkAutoAttack2();
            }
        }
    }
}